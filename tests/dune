
(rule
  (targets conf_invalid.out)
  (deps (:conf conf_invalid.sexp))
  (package benchpress)
  (action
    (progn
      (with-accepted-exit-codes
        1
        (with-outputs-to
          %{targets}
          (run ../src/bin/benchpress_bin.exe check-config -v %{conf})))
      (run sed -i "s/reading.*//g" %{targets})
      (run sed -i "s/.*in file.*//g" %{targets})
      )))

(rule
  (alias runtest)
  (package benchpress)
  (action (diff conf_invalid.expected conf_invalid.out)))
